<!DOCTYPE html>
<html lang="en">

	<head>
		<title>A4 Marking Scheme (Draft)</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="author" content="Andrey Konstantinov">
		<link rel="icon" href="https://cdn4.iconfinder.com/data/icons/business-2-7/512/checklist-512.png">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
		<style>
			.capsized {
				-moz-transform: rotate(180deg);
				-webkit-transform: rotate(180deg);
				-o-transform: rotate(180deg);
				-ms-transform: rotate(180deg);
				transform: rotate(180deg);
			}
		</style>
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
		<script>
			function populateTable(reqsArray) {
				reqsArray.forEach(function(element) {
					let node = '<td scope="col" style="text-align:center;"><div class="form-check"><input class="form-check-input mark-checkbox" type="checkbox" value=5 onChange="adjustMark(this)"></div></td><td style="text-align:center;"><span class="badge badge-secondary badge-mark">+5</span></td><td>'	+ element + '</td></tr>';
					tableBody.insertAdjacentHTML('beforeend', node)
				});
				let loginFeatureNode = '<td scope="col" style="text-align:center;"	><div class="form-check"><input class="form-check-input mark-checkbox" type="checkbox" value=15 onChange="adjustMark(this)"></div></td><td style="text-align:center;"><span class="badge badge-secondary badge-mark">+15</span></td><td>'	+ "Successful login and unsuccesful login; and indication of success/failure when logging in" + '</td></tr>';
				let thirdPartyNode = '<td scope="col" style="text-align:center;"><div class="form-check"><input class="form-check-input malus-checkbox" type="checkbox" value="thirdParty" onChange="toggleMalus(this)"></div></td><td style="text-align:center;"><span class="badge badge-secondary badge-mark">-30%</span></td><td style="color:red;">'	+ "Use of third party framework or libraries" + '</td></tr>';
				let browserIncompatNode = '<td scope="col" style="text-align:center;"><div class="form-check"><input class="form-check-input malus-checkbox" type="checkbox" value="browserIncompat" onChange="toggleMalus(this)"></div></td><td style="text-align:center;"><span class="badge badge-secondary badge-mark">-20%</span></td><td style="color:red;">'	+ "Browser incompatibility" + '</td></tr>';
				let cheatingNode = '<td scope="col" style="text-align:center;"><div class="form-check"><input class="form-check-input malus-checkbox" type="checkbox" value="cheating" onChange="toggleMalus(this)"></div></td><td style="text-align:center;"><span class="badge badge-secondary badge-mark">-100%</span></td><td style="color:red;">'	+ "Violation of academic integrity or inability to explain your code" + '</td></tr>';
				[loginFeatureNode, thirdPartyNode, browserIncompatNode, cheatingNode].forEach(function(element) {
					tableBody.insertAdjacentHTML('beforeend', element)
				});
			}
			
			function calculateMark() {
				adjustedMark = Math.max(mark - mark * penalties.cheating - 0.3 * mark * penalties.thirdParty - 0.2 * mark * penalties.browserIncompat, 0)*100/125;
				adjustedMark = Math.round(adjustedMark * 10) / 10;
				
				icon = '<i class="fas fa-check fa-1x"></i>';
				failIcon = '<i class="fas fa-times fa-1x"></i>';
				
				switch(true) {
					case (adjustedMark >= 90):
						grade = "A+";
						break;
					case (adjustedMark >= 85):
						grade = "A";
						break;
					case (adjustedMark >= 80):
						grade = "A-";
						break;
					case (adjustedMark >= 75):
						grade = "B+";
						break;
					case (adjustedMark >= 70):
						grade = "B";
						break;
					case (adjustedMark >= 65):
						grade = "B-";
						break;
					case (adjustedMark >= 60):
						grade = "C+";
						break;
					case (adjustedMark >= 55):
						grade = "C";
						break;
					case (adjustedMark >= 50):
						grade = "C-";
						break;
					case (adjustedMark >= 45):
						grade = "D+";
						icon = failIcon;
						break;
					case (adjustedMark >= 40):
						grade = "D";
						icon = failIcon;
						break;
					default:
						grade = "D-";
						icon = failIcon;
				}
				totalMark.innerHTML = icon + " " + adjustedMark + "% (" + grade + ")";
				enableSave();
			}
			
			function adjustMark(cb) {
				mark = (cb.checked) ? mark + parseInt(cb.value) : mark - parseInt(cb.value);
				calculateMark();
				flipBadge(cb, cb.checked, false);
			}
			
			function toggleMalus(cb) {
				penalties[cb.value] = cb.checked ? 1 : 0;
				flipBadge(cb, cb.checked, true);
				calculateMark();
			}
			
			function flipBadge(element, makeActive, isRed) {
				badgeColor = isRed ? "badge-danger" : "badge-success";
				matchingBadge = element.parentElement.parentElement.nextSibling.getElementsByClassName('badge-mark')[0];
				if (makeActive) {
					matchingBadge.classList.remove("badge-secondary");
					matchingBadge.classList.add(badgeColor);
				} else {
					matchingBadge.classList.remove(badgeColor);
					matchingBadge.classList.add("badge-secondary");
				}
			}
			
			function checkAll(cb) {
				let value = cb.checked ? 125 : 0;
				Array.prototype.forEach.call(checkboxes, function(element) {
					element.checked = cb.checked;
					flipBadge(element, cb.checked, false);
				});
				
				if (!cb.checked) {
					Array.prototype.forEach.call(malusCheckboxes, function(element) {
					element.checked = cb.checked;
					flipBadge(element, cb.checked, true);
					});
					penalties.cheating = 0;
					penalties.browserIncompat = 0;
					penalties.thirdParty = 0;
				}
				
				mark = value;
				calculateMark();
			}
			
			function saveData() {
				savedMarks = [];
				savedMali = [];
				Array.prototype.forEach.call(checkboxes, function(element) {
					savedMarks.push(element.checked);
				});
				
				Array.prototype.forEach.call(malusCheckboxes, function(element) {
					savedMali.push(element.checked);
				});

			localStorage.setItem("storedMarks", JSON.stringify(savedMarks));
			localStorage.setItem("storedMali", JSON.stringify(savedMali));
			
			document.getElementById("saveButton").style.display = "none";
			document.getElementById("saveNotif").style.display = "block";
			}
			
			function enableSave() {
				document.getElementById("saveNotif").style.display = "none";
				document.getElementById("saveButton").style.display = "block";
			}
			
			function retrieveData() {
				savedMarks = JSON.parse(localStorage.getItem("storedMarks"));
				savedMali = JSON.parse(localStorage.getItem("storedMali"));
		
				for (i = 0; i < savedMarks.length; i++) {
					checkboxes[i].checked = savedMarks[i];
					if (checkboxes[i].checked){
						adjustMark(checkboxes[i], parseInt(checkboxes[i].value));
					}
				}
				
				for (i = 0; i < savedMali.length; i++) {
					malusCheckboxes[i].checked = savedMali[i];
					toggleMalus(malusCheckboxes[i], malusCheckboxes[i].value);
				}
			}
			
			function q3tourney4(identity) {
				capsized = (identity.value === "identityOther") ? true : false;
				localStorage.setItem("capsized", JSON.stringify(capsized));
				capsize(capsized);
				jumpToTop();
			}
			
			function capsize(bool) {
				if (bool) {
					document.body.classList.add("capsized");
					document.body.classList.add("mb-3");
				} else {
					document.body.classList.remove("capsized");
					document.body.classList.remove("mb-3");
				}
			}
			
			function reAlign() {
				capsized = JSON.parse(localStorage.getItem("capsized"));
				if (capsized) {
					document.getElementById("defaultIdentityRadio").checked = false;
					document.getElementById("otherIdentityRadio").checked = true;
				} else {
					document.getElementById("otherIdentityRadio").checked = false;
					document.getElementById("defaultIdentityRadio").checked = true;
				}
				capsize(capsized);
			}
			
			function jumpToTop() {
				if (capsized) {
					window.scrollTo(0, document.body.scrollHeight);
				} else {
					window.scrollTo(0, 0);
				}
			}
			
			function reset() {
				document.getElementById('check-all-box').checked = false;
				reqsArray = ["Having the logical sections: user registration, login, and shop; plus any other relevant section",
				"Successful user registration",
				"Showing the success status when the registration is successful and showing failure when not",
				"Being able to show the available shop items",
				"Being able to search through the available shop items",
				"Being able to shrink the list of shop items dynamically",
				"Login status (logged in or not) shown",
				"Logout option available and functional (when logged in)",
				"Purchase action re-directed to login if the user is not currently logged in",
				"Successful purchase message displayed well when the user is logged in",
				"The overall look and feel of the site",
				"N01: Find out where SQL injection is possible within the service APIs. Write down an HTTP request that injects SQL.",
				"N02: Find out where HTML injection is possible within the service APIs. Write down an HTTP request that injects HTML.",
				"N03: Using HTML injection above, write down an HTTP request that inserts an arbitrary image into the UI you constructed.",
				"N04: Write down an HTTP request that leads to executing a user-supplied script.",
				"N05: The services do not stop cross-site request forgery (CSRF) attacks. Describe in a single sentence how a cross-site request forgery attack could be mounted on the service.",
				"N06: Combine the CSRF vulnerability you found above in N05 and the XSS vulnerability you mentioned in N04 in an HTTP request. Write this request down.",
				"C01: Open the database file using a binary editor. Use the <a href=\"https://en.wikipedia.org/wiki/Magic_number_%28programming%29\">magic number</a> in the file to find out the name of the database management system. Write down the name of this database management system.",
				"C02: Get a tool that is able to open the contents of the above database, and examine the contents of the database using this tool. How many tables exist in the database?",
				"C03: One of the tables in the database contains user credentials. There are two users in the supplied database, one is jbon007, what is the name of the other?",
				"C04: Find out the password of the user you mentioned in C03 above. The password is thought to be a common dictionary word. For example, you can find a list of commonly used words <a href=\"https://www.wordfrequency.info/free.asp\">here</a>.",
				"C05: In the data pack the service uses, there is a folder containing large images, and the service does not publish any of the images from this folder. Craft an HTTP request that can still give a network user access to one of the images in this folder. Write down this HTTP request."];
				mark = 0;
				capsized = false;
				savedMarks = [];
				savedMali = [];
				penalties = {thirdParty: 0, browserIncompat: 0, cheating: 0};
				checkboxes = document.getElementsByClassName('mark-checkbox');
				malusCheckboxes = document.getElementsByClassName('malus-checkbox');
				tableBody = document.getElementById('marking-table-body');
				totalMark = document.getElementById('total-mark');
			}
		</script>
	</head>
	
	<body>
			
			<div class="container-fluid mt-3 pl-3">
				<div class="row">
					<div class="col-sm-10">
						<div class="alert bg-dark px-2">
							<h5 style="color:white;"><i class="fas fa-clipboard-list fa-1x"></i>A4 Marking Scheme (Draft)</h5>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-8">
						<table class="table table-bordered" style="table-layout:auto">
							<thead>
								<tr>
									<th scope="col" style="vertical-align: top; text-align:center;"><div class="form-check"><input id="check-all-box" class="form-check-input" type="checkbox" onChange="checkAll(this)"></div></th>
									<th scope="col" style="text-align:center;">±</th>
									<th scope="col" style="text-align:left;">Requirement</th>
								</tr>
							</thead>
							<tbody id="marking-table-body">
								<tr>
							</tbody>
						</table>
					</div>
					<div class="col-sm-2">
						<div class="card w-auto">
							<div class="card-header bg-dark" style="color:white;">Total marks</div>
							<div class="card-body">
								<p id="total-mark" class="card-text">0</p>
							</div>
							<div class="card-footer">
								<button type="button" id="saveButton" class="btn btn-success" onClick="saveData()"><i class="fas fa-save fa-1x"></i> Save marks</button>
								<button type="button" id="saveNotif" class="btn btn-success" disabled style="display: none;"><i class="fas fa-check fa-1x"></i> Saved.</button>
							</div>
						</div>
						<div class="card w-auto mt-3">
							<div class="card-header bg-dark" style="color:white;"></div>
							<div class="card-body">
								<div class="form-check">
									<input class="form-check-input" type="radio" name="identitySelector" id="otherIdentityRadio" value="identityOther" onChange="q3tourney4(this)">
									<label class="form-check-label" for="otherIdentityRadio"></label>
								</div>
								<div class="form-check">
									<input checked class="form-check-input" type="radio" name="identitySelector" id="defaultIdentityRadio" value="identityDefault" onChange="q3tourney4(this)">
									<label class="form-check-label" for="defaultIdentityRadio"></label>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-8">
						<div class="alert alert-light px-0" role="alert">
							<i class="fas fa-bolt fa-1x"></i> Powered by <img src="https://upload.wikimedia.org/wikipedia/commons/e/ea/Boostrap_logo.svg" height="15" width="15"> <a href="https://getbootstrap.com/docs/4.1/getting-started/introduction/">Bootstrap 4.1.3</a>, <i class="fas fa-flag fa-1x"></i> <a href="https://fontawesome.com/how-to-use/on-the-web/setup/getting-started?using=web-fonts-with-css">Font Awesome 5.2.0</a> and <i class="far fa-clock fa-1x"></i> <a href="https://i.kym-cdn.com/photos/images/original/000/101/781/Y0UJC.png">extreme procrastination</a> Credit: Andrey Konstantinov. <button type="button" class="btn btn-link mt-0 p-0" style="float: right;" onClick="jumpToTop()">To top <i class="fas fa-long-arrow-alt-up fa-1x"></i></button>
						</div>
					</div>
				</div>
			</div>
		
		<script>
			reset();
			populateTable(reqsArray);
			if (localStorage.getItem("storedMarks") != null) {
				retrieveData();
			}
			
			calculateMark();
			
			if (localStorage.getItem("capsized") != null) {
				reAlign();
			}
		</script>
	</body>
	
</html>